---
layout: Post
title: test续
subtitle: 测试续
author: a xi
date: 2023-02-24
useHeaderImage: true
headerImage: /images/home-bg/home-bg-3.jpg
headerMask: rgb(14, 21, 5, .2)
permalinkPattern: /post/:year/:month/:day/:slug/
tags:
  - test
---

## Jmeter

Apache JMeter是Apache组织开发的基于Java的压力测试工具。

适用的测试领域：<br>
压力测试，最初被设计用于Web应用测试，功能/回归测试，性能测试，接口测试，数据库压力测试；

线程组：一个虚拟用户

接口的请求数据类型：
		默认是表单类型
		如果接口请求数据类型是json，需要指定一下请求头http默认值:
http默认值

JSON提取器

事务控制器
事务就是将一系列的请求列为一个总的事务，这样利于业务统计，也就是TPS。TPs通常指的就是每秒完成的事务数量，这个具体事务就需要我们去划分。
事务: tps，符合真实用户的操作，触发一系列的请求

仅一次控制器
仅一次控制器是指在运行的时候只运行一次，通常可以将登录的请求放到仅一次控制器，这样就不会一直运行登录的请求了。

吞吐量控制器
吞吐量控制器用在混合压测中，我们在混合压测时需要控制压测到达服务器的请求数据的比例，比如服务器在生产中，查询的比例占50%，新增的请求古20%，修改占20%，删除占10%这样的比例。

思考时间<br>
思考时间，如果用了思考时间后需要更多的并发数才可以压出系统的瓶颈，那意味着要更多的测试资源（测试机器)

集合点（同步定时器):
可以设置在一定的用户数量到达之后，然后再同时去请求

单交易基准:
使用一个用户或一个线程，延时设置为0，对一个交易持续运行1分钟以上。
该场景的主要目的是获取单个交易在无压力的情况下的基准响应时间及环境资源使用情况，
作用：作为其他场景的参考依据。

单交易负载:（逐渐添加并发数，最大和最优处理能力，找到拐点)
指通过逐渐增加压力直至性能拐点的方式，验证单交易是否存在并发性问题，
获取被测系统对单交易的最大处理能力及其它相关指标的性能表现，通常在进行业务性能测试场景时，需要先将业务中的单接口性能优化达标后才进行业务场景混压。
当用户逐渐增加时候，tps一直往上增,，停止增长了，说明达到瓶颈，
然后响应时间越来越慢，系统处理事务越来越少，就慢慢下降那到底开始压多少，慢慢增，试压



混合负载：
加载方式和单负载测试一样，目的是为了验证混合业务时系统的最优或最大TPS及其它相关指标的性能表现。
区别在于单负载测的是某一个接口，而混合负载的时候是根据一定测试模型进行的。那么必然就会有多个接口。
注意：设置测试模型，业务比例，真实模拟情况



压力测试：
压力测试指的是直接并发负载测试得到的最大并发数，
也就是我们出现拐点的时候的并发数量。
验证的是系统在突然出现大的并发的时候，能否支撑的住。



压力测试的并发数是多少?
有预期的数值？一次性达到?有上次性能测试的结果值? 100 200 300 参照上次性能测试的结果200       2:8
无预期的数值？只有参考的在线用户数？2:8原则--->可以用在线用户数的20%作为参考去测试。

*关注哪些参数？*

响应时间  1  3  5  /  2  5  8，参考值---在性能测试的基础上 去进行有必要的调整

tps  越高越好，会有极限值-根据这个结果~~去做进一步的并发数/脚本的调整---去看tps

错误率 越低越好 ，99.99%不可嫩恶搞达成，90%的正确率，如果是银行业务/金融业务 100%的正确率/有对应的容错机制/处理机制

cpu 内存 队列 磁盘使用情况，80%，20%空余，<1，磁盘：读写频率不要过高过快，



线程数：就是并发数，目标100采取叠加的方式去进行添加
启动时间：每秒启动多少个(可以根据结果去进行调整），策略:想要服务器压力大点就时间少，想要服务器的压力慢慢增加就时间长点。
循环次数：指定次数or永远（跟下面的持续时间配合使用)
调度器:配合永远使用，去设置持续时间



负载测试：逐步增加并发数
稳定性测试：时间确定～～查看该时间段内的性能情况。



聚合报告 jtl

重点关注的几个数据：

Average：平均响应时间—默认情况下是单个Request的平均响应时间，当使用了TransactionController时，也可以以Transaction为单位显示平均响应时间<br>
Median：中位数，也就是50%用户的响应时间<br>
90% line：90%用户的响应时间<br>
Min：最小响应时间<br>
Max：最大响应时间<br>
Error%：本次测试中出现错误的请求的数量 / 请求的总数<br>
Throughput：吞吐量—默认情况下表示每秒完成的请求数（Request per Second)，当使用了Transaction Controller时，也可以表示类似LoadRunner 的 Transaction per Second数



执行测试脚本：jmeter -n -t test.jmx<br>
在压力测试结束时间时同时自动生成报告

示范：jmeter -n -t "D:\2019录播计划\Jmeter\脚本\58Jmeter WEB脚本参数化.jmx" -l testresultFile.csv -e -o d:/test_result

参数:
-e：在脚本运行结束后生成html报告
-o：保存html报告的路径，此文件夹必须为空或者不存在



**QPS/TPS/并发量/系统吞吐量的概念**

QPS：每秒钟处理完请求的次数；注意这里是处理完。具体是指发出请求到服务器处理完成功返回结果。可以理解在server中有个counter，每处理一个请求加1，1秒后counter=QPS。

TPS：每秒钟处理完的事务次数，一般TPS是对整个系统来讲的。一个应用系统1s能完成多少事务处理，一个事务在分布式处理中，可能会对应多个请求，对于衡量单个接口服务的处理能力，用QPS比较多。

并发量：系统能同时处理的请求数

  RT：响应时间，处理一次请求所需要的平均处理时间

计算关系：<br>
  QPS = 并发量 / 平均响应时间

  并发量 = QPS * 平均响应时间



性能测试报告一般包含了如下几大模块:<br>
- 性能测试的目的
- 性能测试的背景
- 性能测试的目标
- 性能测试的工具选择
- 性能测试环境的说明
- 性能测试场景的设计
- 性能测试的具体流程
- 性能测试的结果分析
- 性能测试的总结



## Fiddler



## Charles

带宽【吞吐量<br>
利用率<br>
请求往返延迟【延时<br>
最大传输单元<br>
可靠性【丢包】<br>
稳定性【抖动】<br>
不稳定质量范围<br>

弱网例子：以下配置用于模拟不太好的2G蜂窝网络:<br>
带宽256 kbps (上传和下载) / 利用100% / 延迟300 ms / MTU为1500字节 / 可靠性75% / 稳定75% / 不稳定的质量范围为20%至25%
